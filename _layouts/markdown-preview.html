<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Prévisualisation Markdown</title>
<link rel="stylesheet" href="{{ "/assets/style.css" | relative_url }}">
<style>
  .editor-container {
    display: flex;
    height: 90vh;
    gap: 20px;
    padding: 20px;
  }
  textarea {
    flex: 1;
    resize: none;
    font-family: monospace;
    font-size: 16px;
    padding: 12px;
    border: 1px solid var(--border);
    border-radius: 8px;
    flex-grow: 3;
  }
  .preview {
    flex: 1;
    flex-grow: 5;
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 20px;
    background: var(--card);
  }
  .p-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 16px;
  }
  .p-image {
    width: 120px;
    height: 120px;
    object-fit: cover;
    border-radius: 12px;
  }
  .p-title { margin: 0; color: var(--accent-dark); }
  .infos { font-size: 14px; color: var(--muted); }
  .p-tags a { margin-right: 6px; text-decoration: none; color: var(--accent); }
  .post-content { margin-top: 24px; }
</style>
</head>
<body>
  <header class="site-header" style="height: 60px; padding: 0px;">
    <div class="header-inner" style="margin: 0px; padding: 0px;">
      <div class="title-box" style="text-align: center; margin: 0px; padding: 5px 0px 5px 80px;">
        <h1>Prévisualisation Markdown</h1>
      </div>
    </div>
  </header>

  <div class="editor-container">
    <textarea id="editor">---
layout: post
title: "Prévisualisation"
date: 2025-10-02
author: "Bientôt VOUS"
tags: ["markdown","site", "tuto"]
image: "{{ "/assets/images/default-image.jpg" | relative_url }}"
---

# Écrivez votre post en Markdown
Ceci est une prévisualisation de votre post en Markdown.

1. Modifiez le texte dans la colonne de gauche
2. Voyez le rendu en temps réel à droite

Rappel des syntaxes courantes :
- `#` pour les titres
- `*` ou `_` pour l'italique et le gras
- `-` pour les listes
- `>` pour les citations
- `[texte](lien)` pour les liens
- `![texte](image)` pour les images
- `---` pour un séparateur
- Deux espaces après le texte pour un retour à la ligne, une ligne vide pour sauter une ligne

*Pour plus d'informations, consulte [la documentation Markdown](https://www.markdownguide.org/basic-syntax/).*</textarea>
    <div id="preview" class="preview"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script>
    const editor = document.getElementById("editor");
    const preview = document.getElementById("preview");

    function parseFrontMatter(text) {
      const match = /^---\n([\s\S]*?)\n---\n([\s\S]*)$/m.exec(text);
      if (!match) return { front: {}, content: text };
      const yaml = match[1];
      const content = match[2];
      const front = {};
      yaml.split(/\r?\n/).forEach(line => {
        const [key, ...rest] = line.split(":");
        if (!key) return;
        let value = rest.join(":").trim();
        // Gère tableaux type ["a","b"]
        if (value.startsWith("[") && value.endsWith("]")) {
          value = value.slice(1, -1).split(",").map(v => v.replace(/["']/g, "").trim());
        } else {
          value = value.replace(/^["']|["']$/g, "");
        }
        front[key.trim()] = value;
      });
      return { front, content };
    }

    function render() {
      const raw = editor.value;
      const { front, content } = parseFrontMatter(raw);
      const html = marked.parse(content, { breaks: true });

      const tagsHtml = (front.tags || [])
        .map(tag => `<a href="/blog?tag=${tag.toLowerCase()}#title" class="tag">#${tag}</a>`)
        .join(" ");

      preview.innerHTML = `
      <article class="post">
        <div class="p-header">
          <img src="${front.image || '/assets/images/default-image.jpg'}" alt="Image" class="p-image"/>
          <div>
            <h2 class="p-title">${front.title || '(Sans titre)'}</h2>
            <div class="infos">
              <p class="p-date">Publié le ${front.date || 'date inconnue'}</p>
              <p class="p-author"><a href="/blog?author=${encodeURIComponent(front.author || '')}#title" class="author">${front.author || ''}</a></p>
              <p class="p-tags">${tagsHtml}</p>
            </div>
          </div>
        </div>
        <div class="post-content">${html}</div>
      </article>`;
    }

    editor.addEventListener("input", render);
    render();
  </script>
</body>
</html>
